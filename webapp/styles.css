html, body {
    height: 100%;
}

body {
    font-family: Arial, sans-serif;
    background-color: #2c3e50;
    color: white;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    text-align: center;
    /* По умолчанию запрещаем прокрутку всей страницы.
       Прокрутка будет разрешена только на экране выбора уровней
       (там скроллим внутри #screen-levels). */
    overflow: hidden;
    user-select: none; /* Чтобы текст не выделялся при кликах */
    -webkit-tap-highlight-color: transparent;
}

/* На мобильных WebView (Telegram Android/iOS) вертикальное центрирование body часто
   приводит к тому, что нижние элементы (кнопки на ФИНИШ) оказываются за пределами
   видимой области. На узких/низких экранах прижимаем контент к верху и даём отступы
   сверху/снизу, чтобы кнопки гарантированно попадали в область прокрутки. */
@media (max-width: 900px), (max-height: 740px) {
    body {
        justify-content: flex-start;
        padding-top: 18px;
        padding-bottom: 90px; /* место под fixed нижнюю панель, если она появится */
        min-height: 100vh;
        min-height: 100dvh;
    }
}

/* PERF: blur/backdrop-filter очень дорогой на мобилках (особенно iOS).
   Во время игры выключаем его, чтобы поднять FPS. */
#doodle-container.game-running .doodle-control {
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
}

h1, h2 {
    margin-bottom: 10px;
}

p {
    color: #bdc3c7;
    margin-bottom: 20px;
}

/* === Управление экранами === */
.screen {
    display: none;
    width: 90%;
    max-width: 400px;
    padding: 20px;
    box-sizing: border-box;

    /* Mobile/WebView safety:
       In Telegram WebView the viewport height is fixed and the body is vertically centered.
       When content becomes taller (e.g., FINISH stats list), bottom buttons may fall below
       the visible area. Make each screen scrollable within itself.
    */
    /* Fallback для WebView без dvh */
    max-height: calc(100vh - 40px);
    /* Fallback: сначала 100vh (везде), затем 100dvh (точнее на мобилках) */
    max-height: calc(100vh - 40px);
    max-height: calc(100dvh - 40px);
    /* По умолчанию экраны НЕ прокручиваются. */
    overflow: hidden;
    touch-action: manipulation;
}

/* Разрешаем прокрутку ТОЛЬКО на экране выбора уровней */
#screen-levels {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
}

/* =====================
   ADMIN PANEL
   ===================== */
body.admin-body {
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
    justify-content: flex-start; /* не прижимаем контент к центру по вертикали */
    align-items: center;
    padding-top: 18px;
    padding-bottom: 24px;
    user-select: text;
    -webkit-user-select: text;
    -ms-user-select: text;
}

.admin-screen {
    /* админка должна скроллиться как страница */
    max-width: 1000px;
    width: 92%;
    max-height: none;
    overflow: visible;
    text-align: center;
    /* разрешаем свайп-скролл (у .screen по умолчанию touch-action: none) */
    touch-action: pan-y;
}

.admin-wrap {
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
}

.admin-home {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 10px;
    justify-content: center;
    margin: 16px auto 10px;
}

.admin-home-btn {
    width: 100%;
}

.admin-page-head {
    display: grid;
    grid-template-columns: auto minmax(0, 1fr) auto;
    gap: 10px;
    align-items: center;
    justify-items: center;
    margin: 12px 0 10px;
}

.admin-page-title {
    font-weight: 800;
    text-align: center;
}

.admin-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
    margin: 12px 0;
}

.admin-nav {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
    margin: 14px 0 10px;
}

/* Табы больше не нужны, но оставляем стили, чтобы не ломать другие части */

.admin-tab {
    min-width: 160px;
}

.admin-tab.active {
    outline: 2px solid rgba(255,255,255,0.35);
}

.admin-panels {
    width: 100%;
    display: flex;
    justify-content: center;
}

.admin-panel {
    width: 100%;
    max-width: 900px;
}

.admin-panel[aria-hidden="true"] {
    display: none;
}

.admin-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
}

.admin-input {
    flex: 1;
    min-width: 220px;
    padding: 10px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(0,0,0,0.15);
    color: #fff;
}

/* --- Awards: выбор шрифта (mobile-friendly) --- */
.admin-font-mobile {
    width: 100%;
}

.admin-font-mobile-btn {
    width: 100%;
    /* .btn по умолчанию имеет margin-top:20px, из-за этого между
       выбором шаблона и кнопкой "Выбрать шрифт" появляется большой зазор.
       Для кнопки выбора шрифта в админке убираем этот отступ. */
    margin-top: 0;
}

.admin-font-mobile-preview {
    margin-top: 8px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(0,0,0,0.10);
    text-align: left;
}

.admin-font-mobile-label {
    font-weight: 800;
    opacity: 0.9;
}

.admin-font-mobile-sample {
    margin-top: 4px;
    opacity: 0.85;
    font-size: 0.98em;
}

.admin-font-modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    display: none;
    align-items: flex-end;
    justify-content: center;
    z-index: 9999;
}

.admin-font-modal.open {
    display: flex;
}

.admin-font-modal-sheet {
    width: 100%;
    max-width: 900px;
    border-radius: 18px 18px 0 0;
    background: rgba(25, 35, 50, 0.98);
    border: 1px solid rgba(255,255,255,0.18);
    padding: 14px;
    max-height: 78vh;
    overflow: hidden;
}

.admin-font-modal-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}

.admin-font-modal-title {
    font-weight: 900;
    text-align: left;
}

.admin-font-modal-list {
    margin-top: 12px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    max-height: calc(78vh - 80px);
    padding-bottom: 8px;
}

.admin-font-item {
    width: 100%;
    text-align: left;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(0,0,0,0.10);
    color: #fff;
    border-radius: 14px;
    padding: 12px;
    cursor: pointer;
    margin: 8px 0;
}

.admin-font-item-name {
    font-weight: 900;
}

.admin-font-item-sample {
    opacity: 0.82;
    margin-top: 4px;
}

/* --- Awards: дата (календарь) --- */
 .admin-date-field {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
}

.admin-date-input {
    width: 100%;
    font-size: 16px; /* чтобы iOS не делал zoom */
    padding-right: 44px; /* место под иконку */
}

.admin-date-btn {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    border: 0;
    background: transparent;
    color: rgba(255,255,255,0.92);
    padding: 6px;
    border-radius: 10px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.admin-date-btn:active {
    transform: translateY(-50%) scale(0.98);
}

/* прячем нативную "стрелку"/индикатор, оставляем наш значок */
#award-date::-webkit-calendar-picker-indicator {
    opacity: 0;
    display: none;
}

@media (max-width: 640px) {
    .admin-date-input {
        padding: 12px 12px;
        min-height: 48px;
        width: 100%;
    }

    .admin-date-btn {
        right: 8px;
        padding: 8px;
    }

    .admin-actions-bottom .btn {
        width: 100%;
    }
}

.admin-levels {
    display: grid;
    gap: 10px;
    margin-top: 10px;
}

/* Списки пользователей (удаление / награждение) */
.admin-userlist {
    margin-top: 10px;
    width: 100%;
    max-height: 320px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 14px;
    background: rgba(0,0,0,0.10);
    padding: 6px;
}

/* Грамоты: выравниваем список пользователей по левому краю как остальные поля.
   Раньше контейнер имел внутренний padding, из-за чего карточки списка начинались правее инпутов. */
#screen-admin-awards #awards-list.admin-userlist {
    padding: 0;
}

#screen-admin-awards #awards-list .admin-useritem {
    margin: 0;
    border-radius: 0;
    border-left: none;
    border-right: none;
    border-top: none;
    border-bottom: 1px solid rgba(255,255,255,0.10);
}

#screen-admin-awards #awards-list .admin-useritem:first-child {
    border-top-left-radius: 14px;
    border-top-right-radius: 14px;
}

#screen-admin-awards #awards-list .admin-useritem:last-child {
    border-bottom: none;
    border-bottom-left-radius: 14px;
    border-bottom-right-radius: 14px;
}

.admin-useritem {
    width: 100%;
    text-align: left;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(0,0,0,0.12);
    color: #fff;
    border-radius: 12px;
    padding: 10px 12px;
    cursor: pointer;
    margin: 6px 0;
}

.admin-useritem:hover {
    border-color: rgba(255,255,255,0.22);
}

.admin-useritem.selected {
    outline: 2px solid rgba(255,255,255,0.35);
    border-color: rgba(255,255,255,0.25);
}

.admin-useritem-name {
    font-weight: 800;
}

.admin-useritem-meta {
    opacity: 0.75;
    font-size: 0.92em;
    margin-top: 2px;
}

.admin-selected {
    margin-top: 8px;
    padding: 10px;
    border-radius: 12px;
    border: 1px dashed rgba(255,255,255,0.18);
    background: rgba(0,0,0,0.10);
}

/* На странице "Игры" список может быть длинным — делаем прокрутку удобной */
#screen-admin-levels .admin-levels {
    max-height: none;
    overflow: visible;
}

@media (max-width: 720px) {
    .admin-home {
        grid-template-columns: 1fr;
    }
    .admin-page-head {
        grid-template-columns: 1fr;
    }
    .admin-page-head .btn {
        width: 100%;
    }
}

.screen.active {
    display: block;
    animation: fadeIn 0.5s;
}

/* ФИНИШ: кнопки должны быть обычным блоком прямо под статистикой
   (без sticky/absolute), чтобы на Android WebView они не "пропадали". */
.final-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 12px;
}

.final-actions .btn {
    /* На финале — как и в остальных местах — по ширине контейнера */
    width: 100%;
}

@media (max-width: 520px) {
    .final-score-box { margin: 16px 0; padding: 16px; }
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* === Кнопки === */
.btn {
    background-color: #e67e22;
    color: white;
    border: none;
    padding: 15px 30px;
    font-size: 18px;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 20px;
    width: 100%;
    font-weight: bold;
    transition: transform 0.1s, background-color 0.2s;
}

.btn:active {
    transform: scale(0.98);
}

.btn:hover {
    background-color: #d35400;
}

.hidden {
    /*
      Important: some UI blocks (e.g. .bottombar) define their own `display` later in the CSS.
      Without `!important` the later rule wins and "hidden" elements may become visible.
    */
    display: none !important;
}

/* === Верхняя кнопка "К уровням" во время прохождения === */
.topbar {
    position: fixed;
    /* Поднимаем максимально к верху, но уважаем safe-area (notch) */
    top: 0;
    left: 10px;
    z-index: 1001; /* поверх игровых оверлеев */
    width: auto;
}

.topbar-btn {
    background: rgba(0,0,0,0.25);
    color: white;
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 12px;
    padding: 10px 12px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
}

.topbar-btn:active {
    transform: scale(0.98);
}

/* === Кнопка "Звук" (только меню) === */
.sound-toggle {
    position: fixed;
    /* Поднимаем максимально к верху, но уважаем safe-area (notch) */
    top: 0;
    right: 10px;
    z-index: 1001;
    background: rgba(0,0,0,0.25);
    color: white;
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 12px;
    padding: 10px 12px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
}

.sound-toggle:active {
    transform: scale(0.98);
}

/* === УРОВЕНЬ 1: ПАЗЛ (Анимация) === */
#puzzle-board {
    position: relative; /* База координат */
    width: 300px;
    height: 300px;
    margin: 0 auto;
    background: #2c3e50; /* Фон под пазлом */
}

.puzzle-piece {
    position: absolute; /* Элементы позиционируются относительно board */
    width: 33.33%;      /* Треть ширины */
    height: 33.33%;     /* Треть высоты */

    background-size: 100% 100%;
    background-repeat: no-repeat;
    background-position: center;

    cursor: pointer;
    border: 1px solid #bdc3c7;
    box-sizing: border-box;
    border-radius: 4px;

    /* Магия плавной анимации */
    transition: top 0.3s ease-in-out, left 0.3s ease-in-out, transform 0.2s, border-color 0.2s;
}

.puzzle-piece:hover {
    z-index: 5; /* Подымаем выше остальных при наведении */
    border-color: white;
}

/* Подсветка выбранного */
.puzzle-piece.selected {
    border: 3px solid #e74c3c;
    z-index: 10;
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
}

#puzzle-status {
    font-weight: bold;
    min-height: 24px;
    margin-top: 15px;
}

/* === УРОВЕНЬ 2: ПРОВОДА === */

/* Контейнер для игры */
#wires-game-area {
    position: relative; /* Чтобы внутри позиционировать canvas */
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 300px;
    height: 300px;
    margin: 0 auto;
}

#wire-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* Чтобы клики проходили сквозь холст к кнопкам */
    z-index: 1;
}

.wire-col {
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    height: 100%;
    z-index: 2; /* Поверх канваса */
}

.wire-point {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 4px solid #34495e; /* Темная рамка */
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    transition: transform 0.2s, box-shadow 0.2s;
}

.wire-point:active {
    transform: scale(0.9);
}

/* Цвета проводов (используем яркие цвета) */
.wire-point[data-color="red"] { background: #ff4757; }
.wire-point[data-color="blue"] { background: #1e90ff; }
.wire-point[data-color="green"] { background: #2ed573; }
.wire-point[data-color="yellow"] { background: #ffa502; }

/* Состояние "Выбрано" (первый клик) */
.wire-point.selected {
    border-color: white;
    box-shadow: 0 0 15px white;
    transform: scale(1.2);
}

/* Состояние "Подключено" (нельзя кликать) */
.wire-point.connected {
    opacity: 0.5;
    cursor: default;
    box-shadow: none;
    transform: none;
    border-color: #2c3e50;
}

/* === УРОВЕНЬ 2: JUMPER (Детский стиль) === */

#doodle-ui {
    margin-bottom: 10px;
    background: white;
    padding: 10px;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    color: #2c3e50;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#doodle-ui h2 {
    margin: 0;
    font-size: 18px;
    color: #e67e22; /* Оранжевый заголовок */
}

#doodle-score {
    background: #3498db;
    color: white;
    padding: 5px 10px;
    border-radius: 10px;
    font-weight: bold;
    font-size: 18px;
    will-change: transform;
}

#doodle-container {
    position: relative;
    /* АДАПТАЦИЯ: делаем игровой экран заметно больше */
    width: 100%;
    max-width: 520px;
    /* Высота зависит от экрана телефона (раньше было 60vh) */
    height: 74vh;
    min-height: 480px;

    margin: 0 auto;
    /* Яркое небо вместо темного фона */
    background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
    border: 4px solid #fff;
    border-radius: 20px; /* Сильные скругления */
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);

    overflow: hidden;
    touch-action: manipulation;

    /* PERF: ограничиваем область перерисовки браузера только этим блоком */
    contain: layout paint;
}

/* Интуитивные кнопки управления для уровня 2 (телефон) */
#doodle-controls {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 10px;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    pointer-events: none;
    z-index: 15;
}

#doodle-controls {
    transition: opacity 0.25s ease, transform 0.25s ease;
}

#doodle-controls.controls-hidden {
    opacity: 0;
    transform: translateY(10px);
    pointer-events: none;
}

#doodle-controls.controls-hint .doodle-control {
    animation: doodlePulse 1.1s ease-in-out infinite;
}

@keyframes doodlePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.08); }
}

.doodle-control {
    pointer-events: auto;
    width: 54px;
    height: 54px;
    border-radius: 999px;
    border: 2px solid rgba(255,255,255,0.75);
    background: rgba(44, 62, 80, 0.55);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
}

.doodle-control:active {
    transform: scale(0.95);
}

.doodle-control .arrow {
    font-size: 28px;
    line-height: 1;
    color: #ffffff;
    text-shadow: 0 0 10px rgba(255,255,255,0.25);
}

#doodle-canvas {
    display: block;
    width: 100%;
    height: 100%;
}

/* Красивая плашка старта */
#doodle-start-msg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.85); /* Полупрозрачный белый */
    color: #2c3e50;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
    cursor: pointer;
    z-index: 10;
    border-radius: 16px;
}

.tap-icon {
    font-size: 40px;
    margin-top: 10px;
    animation: bounce 1s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.game-running #doodle-start-msg {
    display: none;
}

/* === ФИНАЛ УРОВНЯ 2 === */
#after-level-container {
    display: none;
    margin-top: 20px;
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.45s ease, transform 0.45s ease;
    will-change: opacity, transform;
}

/* Плавное появление блока "ЗАВОД ЗАПУЩЕН" */
#after-level-container.gate-visible {
    opacity: 1;
    transform: translateY(0);
}

#after-level-img {
    width: 100%;
    border-radius: 15px;
    border: 4px solid white;
    filter: brightness(0.2);
    transition: filter 2s, box-shadow 2s;
}

.lights-on #after-level-img {
    filter: brightness(1.2) contrast(1.1);
    box-shadow: 0 0 30px 10px rgba(255, 215, 0, 0.6);
}
/* Оверлеи (экраны поверх игры) */
.game-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(44, 62, 80, 0.9); /* Темный полупрозрачный фон */
    display: flex; /* Flex чтобы центрировать */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 20;
    opacity: 0;
    pointer-events: none; /* Чтобы клики проходили сквозь, когда скрыт */
    transition: opacity 0.5s ease-in-out; /* Плавное появление */
}

/* Класс, который делает оверлей видимым */
.game-overlay.visible {
    opacity: 1;
    pointer-events: all;
}

#victory-overlay h1 {
    color: #f1c40f;
    font-size: 40px;
    text-shadow: 0 0 20px rgba(241, 196, 15, 0.8);
    transform: scale(0.5);
    transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.game-overlay.visible h1 {
    transform: scale(1);
}

.btn-restart {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 15px 25px;
    font-size: 18px;
    border-radius: 30px;
    cursor: pointer;
    margin-top: 20px;
    box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}
#doodle-timer {
    font-family: monospace; /* Чтобы цифры не скакали */
    font-size: 18px;
    font-weight: bold;
    color: #e74c3c; /* Красный цвет для заметности */
    background: #ecf0f1;
    padding: 5px 8px;
    border-radius: 5px;
}
/* === УРОВЕНЬ 3: 2048 (С КАРТИНКАМИ) === */
.game-2048-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 300px;
    margin: 0 auto 10px auto;
}

.score-box {
    background: #bbada0;
    padding: 5px 10px;
    border-radius: 5px;
    font-weight: bold;
    color: white;
}

#grid-container {
    width: 300px;
    height: 300px;
    background: #bbada0;
    border-radius: 10px;
    margin: 0 auto;
    position: relative;
    padding: 10px;
    box-sizing: border-box;
    touch-action: manipulation;
}

.grid-cell {
    width: 62.5px;
    height: 62.5px;
    background: rgba(238, 228, 218, 0.35);
    border-radius: 5px;
    position: absolute;
}

.tile {
    width: 62.5px;
    height: 62.5px;
    border-radius: 5px;
    position: absolute;
    z-index: 10;

    /* Настройка картинок */
    background-color: #eee4da; /* Фон под картинкой (если прозрачная) */
    background-repeat: no-repeat;
    background-position: center;
    background-size: 85%; /* Размер картинки внутри квадрата */

    /* Скрываем текст (цифры), оставляем только картинки */
    color: transparent;
    font-size: 0;

    /* Анимация движения */
    transition: left 0.15s ease-in-out, top 0.15s ease-in-out, transform 0.1s;
}

/* Анимации появления и слияния */
.tile-new { animation: appear 0.2s ease; }
.tile-merged { animation: pop 0.2s ease; z-index: 20; }

@keyframes appear {
    0% { opacity: 0; transform: scale(0); }
    100% { opacity: 1; transform: scale(1); }
}
@keyframes pop {
    0% { transform: scale(0.8); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

/* === ПРИВЯЗКА КАРТИНОК И ЦВЕТОВ (NEON & BRIGHT) === */

/* Общий стиль для всех плиток с картинками */
.tile {
    background-position: center;
    background-repeat: no-repeat;
    background-size: 80%; /* Картинка чуть меньше, чтобы видеть яркий фон */
    border: 2px solid rgba(0,0,0,0.1); /* Тонкая темная обводка для четкости */
    box-shadow: inset 0 0 10px rgba(255,255,255,0.4); /* Блик внутри */
}

/* 2: Болт - Ядовито-голубой (Cyan) */
.tile-2 {
    background-image: url('assets/bolt.png');
    background-image: image-set(url('assets/bolt.webp') type('image/webp'), url('assets/bolt.png') type('image/png'));
    background-color: #00E5FF;
}

/* 4: Гайка - Лаймовый зеленый */
.tile-4 {
    background-image: url('assets/nut.png');
    background-image: image-set(url('assets/nut.webp') type('image/webp'), url('assets/nut.png') type('image/png'));
    background-color: #32CD32;
}

/* 8: Шестеренка - Яркая Фуксия (Розовый) */
.tile-8 {
    background-image: url('assets/gear.png');
    background-image: image-set(url('assets/gear.webp') type('image/webp'), url('assets/gear.png') type('image/png'));
    background-color: #FF00FF;
}

/* 16: Микросхема - Электрический Оранжевый */
.tile-16 {
    background-image: url('assets/chip.png');
    background-image: image-set(url('assets/chip.webp') type('image/webp'), url('assets/chip.png') type('image/png'));
    background-color: #FF6D00;
}

/* 32: Плата - Глубокий Фиолетовый */
.tile-32 {
    background-image: url('assets/board.png');
    background-image: image-set(url('assets/board.webp') type('image/webp'), url('assets/board.png') type('image/png'));
    background-color: #6200EA;
}

/* 64: Корпус - Насыщенный Красный (Малиновый) */
.tile-64 {
    background-image: url('assets/case.png');
    background-image: image-set(url('assets/case.webp') type('image/webp'), url('assets/case.png') type('image/png'));
    background-color: #D50000;
}

/* 128: Датчик - Яркий Индиго (Синий) */
.tile-128 {
    background-image: url('assets/sensor.png');
    background-image: image-set(url('assets/sensor.webp') type('image/webp'), url('assets/sensor.png') type('image/png'));
    background-color: #2962FF;
}

/* Финальный прибор - золотое свечение */
.tile-256 {
    background-image: url('assets/device.png');
    background-image: image-set(url('assets/device.webp') type('image/webp'), url('assets/device.png') type('image/png'));
    background-color: #edcc61;
    box-shadow: 0 0 15px #ffd700;
    background-size: 95%; /* Чуть крупнее */
}

/* Если вдруг игрок пойдет дальше 256 */
.tile-512 { background-image: url('assets/device.png');
    background-image: image-set(url('assets/device.webp') type('image/webp'), url('assets/device.png') type('image/png')); background-color: #333; }

.instruction {
    font-size: 14px;
    color: #bdc3c7;
    margin-top: 15px;
}
/* === УРОВЕНЬ 4: КВИЗ === */
#quiz-progress {
    color: #95a5a6;
    font-size: 14px;
    margin-bottom: 20px;
}

#question-text {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 30px;
    min-height: 50px; /* Чтобы не прыгало */
}

.answer-btn {
    background-color: #34495e;
    color: white;
    width: 100%;
    padding: 15px;
    margin-bottom: 15px;
    border: none;
    border-radius: 10px;
    text-align: left;
    font-size: 16px;
    cursor: pointer;
    transition: transform 0.1s, background-color 0.2s;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.answer-btn:active {
    transform: scale(0.98);
}

/* Состояния ответов */
.answer-btn.correct {
    background-color: #2ecc71 !important; /* Зеленый */
    border: 2px solid #27ae60;
}

.answer-btn.wrong {
    background-color: #e74c3c !important; /* Красный */
    border: 2px solid #c0392b;
    opacity: 0.6;
}

/* === ЭКРАН ФИНАЛА === */
.final-score-box {
    background: white;
    color: #2c3e50;
    padding: 20px;
    border-radius: 15px;
    font-size: 24px;
    font-weight: bold;
    margin: 30px 0;
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}

#final-score-val {
    color: #e67e22;
    font-size: 36px;
}
/* Таблица результатов */
.score-row {
    display: flex;
    justify-content: space-between;
    font-size: 18px;
    margin-bottom: 10px;
    color: #2c3e50;
    text-align: left;
}

.score-row span:last-child {
    font-weight: bold;
    color: #e67e22;
}

.score-row.total {
    font-size: 24px;
    font-weight: bold;
    color: #c0392b;
    margin-top: 15px;
}

hr {
    border: 0;
    border-top: 1px solid #bdc3c7;
    margin: 10px 0;
}
/* Анимация контейнера с вопросами */
#quiz-container {
    /* Чтобы блок не схлопывался, если вопрос короткий */
    min-height: 300px;

    /* Начальное состояние */
    opacity: 1;

    /* ОЧЕНЬ плавный переход только прозрачности */
    transition: opacity 0.5s ease-in-out;
}

/* Класс для скрытого состояния */
.quiz-hidden {
    opacity: 0;
    pointer-events: none; /* Блокируем клики, пока невидимо */
}


/* === Экран выбора уровня === */
.muted { opacity: 0.8; font-size: 14px; }

.level-list{
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    width: 100%;
    max-width: 420px;
    margin: 14px auto 0;
}
.level-card{
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 14px;
    padding: 12px;
    text-align: left;
}
.level-title{ font-weight: 700; margin-bottom: 6px; }
.level-stats{ font-size: 14px; opacity: 0.9; margin-bottom: 10px; }

.btn.btn-secondary{
    background: rgba(255,255,255,0.12);
    border: 1px solid rgba(255,255,255,0.18);
}

/* Пазл: позволяем разный размер сетки */
.puzzle-piece{
    background-image: url('assets/board.webp');
}



/* Глобальная нижняя кнопка "К уровням" (видна только во время прохождения уровней) */
.bottombar {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 10px;
    display: flex;
    justify-content: center;
    z-index: 20;
    pointer-events: none; /* кликабельна только кнопка */
}
.bottombar button {
    pointer-events: auto;
}



/* === Welcome screen centering === */
#screen-welcome.active {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    transform: translateY(100px);
}


/* ================================
   Aptitude test (профориентация)
   ================================ */

/* Кнопка теста на экране выбора уровней */
.levels-aptitude-wrap{
    display:flex;
    justify-content:center;
    margin: 10px 0 14px;
}
.levels-aptitude-wrap .btn{
    width: min(520px, 92vw);
}

/* Разрешаем прокрутку/клики на экранах теста (в WebView иначе кнопки могут не нажиматься и контент обрезается) */
#screen-aptitude,
#screen-aptitude-result{
    /* Мобильный-first: строго по центру и без вылезаний за правый край */
    width: 94%;
    max-width: 520px;
    box-sizing: border-box;
    margin-left: auto;
    margin-right: auto;

    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    touch-action: pan-y;

    padding-bottom: 96px; /* место под нижние элементы на результатах */
    padding-left: 10px;
    padding-right: 10px;
}

/* Во время прохождения теста опускаем контент ниже (чтобы не перекрывался верхними кнопками WebView) */
#screen-aptitude{
    padding-top: calc(env(safe-area-inset-top, 0px) + 128px);
}

/* На экране результата не нужна большая "пустая шапка" */
#screen-aptitude-result{
    padding-top: calc(env(safe-area-inset-top, 0px) + 24px);
}


@media (max-width: 420px){
    #screen-aptitude,
    #screen-aptitude-result{
        width: 96%;
        max-width: 500px;
        padding-left: 8px;
        padding-right: 8px;
    }
}

/* Центрируем карточку и ответы */
#screen-aptitude.active{
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.test-answers{
    width: 100%;
}
.test-answers .btn{
    text-align: center;
    justify-content: center;
}

.test-card{
    width: min(520px, 92vw);
    margin: 14px auto 0;
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 16px;
    padding: 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}
.test-progress{
    font-size: 13px;
    opacity: 0.85;
    margin-bottom: 10px;
}
.test-question{
    font-size: 18px;
    font-weight: 700;
    margin: 8px 0 12px;
    line-height: 1.25;
}
.test-answers{
    display: grid;
    gap: 10px;
}
.test-answers .btn{
    width: 100%;
    text-align: center;
    justify-content: center;
}
.test-footer{
    display:flex;
    justify-content:center;
    margin-top: 14px;
}

.result-card{
    width: min(620px, 92vw);
    margin: 14px auto 0;
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 16px;
    padding: 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    text-align: center;
    overflow: hidden; /* чтобы ничего не вылезало за границы на мобильном */
}
.result-title{
    font-size: 13px;
    opacity: 0.85;
}
.result-value{
    font-size: 22px;
    font-weight: 800;
    margin-top: 4px;
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
}
.result-value.secondary{
    font-size: 18px;
    font-weight: 700;
    opacity: 0.95;
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
}

/* Плашку с текстом "Тебе интересно..." убрали по требованиям */
.result-explain{ display:none !important; }

.result-bars{
    margin-top: 14px;
    display: grid;
    gap: 8px;
    width: min(520px, 92vw);
    margin-left: auto;
    margin-right: auto;
}
.result-bar{
    display: grid;
    grid-template-columns: minmax(140px, 180px) 1fr 44px;
    gap: 10px;
    align-items: center;
    font-size: 13px;
}

/* Кликабельные подписи шкал (для подсказок по тапу) */
.apt-label{
    background: transparent;
    border: none;
    padding: 0;
    margin: 0;
    color: inherit;
    font: inherit;
    cursor: pointer;
    text-align: left;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
}
.result-bar .pct{
    text-align: right;
    opacity: 0.9;
}

/* На очень узких экранах делаем строки шкал двухрядными: (название + %), затем полоса на всю ширину */
@media (max-width: 420px) {
    .result-bar{
        grid-template-columns: 1fr 44px;
        grid-template-areas:
          "label pct"
          "bar bar";
        row-gap: 6px;
        column-gap: 10px;
    }
    .result-bar .apt-label{ grid-area: label; }
    .result-bar .bar{ grid-area: bar; }
    .result-bar .pct{ grid-area: pct; }
}

.result-block{ text-align: center; }
.apt-label::after{
    content: "ⓘ";
    font-size: 12px;
    opacity: 0.75;
}
.apt-label:active{ opacity: 0.85; }

/* Всплывающая подсказка */
.apt-tooltip{
    position: fixed;
    max-width: min(320px, calc(100vw - 24px));
    padding: 10px 12px;
    background: rgba(0, 0, 0, 0.78);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.18);
    border-radius: 12px;
    font-size: 13px;
    line-height: 1.35;
    z-index: 1000;
    box-shadow: 0 10px 30px rgba(0,0,0,0.35);
}
.apt-tooltip.hidden{ display: none; }
.result-bar .bar{
    height: 10px;
    background: rgba(255,255,255,0.10);
    border-radius: 999px;
    overflow: hidden;
}
.result-bar .fill{
    height: 100%;
    width: 0%;
    background: rgba(255,255,255,0.75);
}
.result-block{ margin-top: 14px; }
.result-subtitle{ font-weight: 800; margin-bottom: 8px; }
.result-list{
    margin: 0;
    padding-left: 0;
    list-style: none; /* убрать точки */
}
.result-chips{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    justify-content: center; /* центрируем рекомендации */
}
.chip{
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(255,255,255,0.10);
    border: 1px solid rgba(255,255,255,0.14);
    font-size: 13px;
    white-space: normal;
    text-align: center;
    max-width: min(520px, 92vw);
}
.result-actions{
    display:flex;
    gap:10px;
    justify-content:center;
    flex-wrap:wrap;
    margin-top: 16px;
}

/* Рекомендации в меню уровней */
.level-card.recommended{
    outline: 2px solid rgba(255,255,255,0.35);
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}
.level-card .recommend-badge{
    display:inline-block;
    margin-left: 8px;
    font-size: 14px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}


/* Проф-тест: фиксируем "панель" (заголовок + подзаголовок) внутри экрана */
#screen-aptitude > h2,
#screen-aptitude > .muted{
    position: sticky;
    top: 0;
    z-index: 2;
    background: rgba(44,62,80,0.92);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    margin-left: auto;
    margin-right: auto;
    text-align: center;
}

/* Чуть разнесём заголовок и текст, чтобы не слипались при sticky */
#screen-aptitude > h2{ padding: 8px 6px 4px; margin-top: 0; }
#screen-aptitude > .muted{ padding: 0 6px 10px; margin-top: 0; }

/* Доп. защита от горизонтального переполнения на мобильных */
#screen-aptitude, #screen-aptitude-result,
#screen-aptitude * , #screen-aptitude-result *{
    max-width: 100%;
}


/* ==========================================================
   FIX: Aptitude test ("Узнать, что мне подходит")
   Задачи:
   1) На телефонах контент должен быть по центру и не выезжать вправо
   2) Кнопка "Пройти ещё раз" должна быть видна (ничего не обрезаем overflow:hidden)
   3) Текст/надписи НЕ должны быть "прикреплены" фикс-позиционированием — пусть идут обычным потоком
   (Логику НЕ трогаем — только стили.)
   ========================================================== */

/* Экраны теста: центрируем и разрешаем вертикальный скролл внутри экрана */
#screen-aptitude,
#screen-aptitude-result{
    width: 100%;
    max-width: 520px;
    margin: 0 auto;
    padding-left: 16px;
    padding-right: 16px;
    box-sizing: border-box;

    /* если текста много на маленьком экране — прокручиваем ВНУТРИ экрана */
    overflow-x: hidden;
    overflow-y: auto;

    /* чтобы экран не вылезал за видимую область */
    max-height: calc(100dvh - 40px);
}

/* Карточки внутри экранов — обычное позиционирование (ничего не фиксируем) */
#screen-aptitude .test-card,
#screen-aptitude-result .result-card{
    position: relative;
    left: auto;
    top: auto;
    transform: none;

    width: 100%;
    max-width: 100%;
    box-sizing: border-box;

    /* НИЧЕГО не обрезаем — чтобы кнопки внизу не пропадали */
    overflow: visible;
    max-height: none;
}

/* Доп. страховка: внутренние элементы не расширяют ширину */
#screen-aptitude *,
#screen-aptitude-result *{
    max-width: 100%;
    box-sizing: border-box;
}


/* ===== APTITUDE TEST OVERRIDES (не закрепляем текст/блоки) ===== */
#screen-aptitude .test-card,
#screen-aptitude .test-progress,
#screen-aptitude .test-question,
#screen-aptitude .test-answers,
#screen-aptitude h2,
#screen-aptitude p {
    position: static !important;
    transform: none !important;
}

#screen-aptitude {
    overflow-y: auto; /* скролл внутри экрана, элементы двигаются вместе с контентом */
    -webkit-overflow-scrolling: touch;
}


/* ============================
   PRELOADER (только изображения)
   ============================ */
.preload-overlay{
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(6px);
}

.preload-card{
    width: min(520px, calc(100vw - 32px));
    background: rgba(255,255,255,0.95);
    border-radius: 18px;
    padding: 18px 16px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.35);
    color: #111;
}

.preload-title{
    font-weight: 800;
    font-size: 16px;
    margin-bottom: 12px;
    text-align: center;
}

.preload-bar-wrap{
    width: 100%;
    height: 12px;
    border-radius: 999px;
    background: rgba(0,0,0,0.12);
    overflow: hidden;
}

.preload-bar{
    height: 100%;
    border-radius: 999px;
    background: #2ecc71;
    width: 0%;
    transition: width 120ms linear;
}

.preload-meta{
    margin-top: 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    align-items: center;
    text-align: center;
}

.preload-percent{
    font-weight: 800;
    font-size: 18px;
}

.preload-current{
    font-size: 13px;
    opacity: 0.85;
    word-break: break-word;
}

/* Скрытие прелоадера */
.preload-overlay.hidden{
    display: none;
}

#screen-admin-awards .btn{
  margin-top: 0 !important;   /* перебиваем .btn { margin-top: 20px } */
}

#screen-admin-awards select{
  margin-bottom: 3x;        /* регулируй 0..12px как нравится */
  width: 100%;
  box-sizing: border-box;
}


