<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ó–∞–≤–æ–¥ –ê–ü–ó</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://telegram.org" crossorigin>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¢–µ–ª–µ–≥—Ä–∞–º–∞ -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

    <!-- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –≤–µ—Ä—Ö–Ω—è—è –∫–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ (–≤–∏–¥–Ω–∞ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π) -->
    <div id="global-topbar" class="topbar hidden">
        <button class="topbar-btn" type="button" data-action="show-levels">‚Üê –ö —É—Ä–æ–≤–Ω—è–º</button>
    </div>

    <!-- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∏–∂–Ω—è—è –∫–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π) -->
    <div id="global-bottombar" class="bottombar hidden">
        <button class="btn btn-secondary" type="button" data-action="show-levels">‚Üê –ö —É—Ä–æ–≤–Ω—è–º</button>
    </div>

    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∑–≤—É–∫–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –º–µ–Ω—é) -->
    <button id="btn-sound-toggle" class="sound-toggle" type="button" aria-label="–ó–≤—É–∫: –≤–∫–ª/–≤—ã–∫–ª">üîä –ó–≤—É–∫</button>


    <!-- –≠–∫—Ä–∞–Ω 1: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <div id="screen-welcome" class="screen active">
        <h1>üè≠ –ê–ü–ó –ö–í–ï–°–¢</h1>
        <p>–ü—Ä–æ–π–¥–∏ –∏—Å–ø—ã—Ç–∞–Ω–∏—è –∏ —Å–æ–±–µ—Ä–∏ –ø—Ä–∏–∑—ã!</p>
        <!-- –í Telegram WebView inline onclick –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è CSP, –ø–æ—ç—Ç–æ–º—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –≤–µ—à–∞–µ–º –≤ script.js -->
        <button id="btn-choose-level" class="btn">–í—ã–±—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
    </div>
    <!-- –≠–∫—Ä–∞–Ω: –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è -->
    <div id="screen-levels" class="screen">
        <h2>üéõÔ∏è –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è</h2>
        <p class="muted">–í—ã–±–∏—Ä–∞–π –ª—é–±–æ–π —É—Ä–æ–≤–µ–Ω—å ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.</p>

        <div class="level-list">
            <div class="level-card">
                <div class="level-title">üß© –¶–µ—Ö —Å–±–æ—Ä–∫–∏ –ª–æ–≥–æ—Ç–∏–ø–∞ 2√ó2 (4 –∫–ª–µ—Ç–∫–∏)</div>
                <div class="level-stats">–õ—É—á—à–µ–µ –≤—Ä–µ–º—è: <span id="stat-puzzle-2x2">‚Äî</span></div>
                <button class="btn" data-level="puzzle-2x2">–ò–≥—Ä–∞—Ç—å</button>
            </div>

            <div class="level-card">
                <div class="level-title">üß© –¶–µ—Ö —Å–±–æ—Ä–∫–∏ –ª–æ–≥–æ—Ç–∏–ø–∞ 3√ó3 (9 –∫–ª–µ—Ç–æ–∫)</div>
                <div class="level-stats">–õ—É—á—à–µ–µ –≤—Ä–µ–º—è: <span id="stat-puzzle-3x3">‚Äî</span></div>
                <button class="btn" data-level="puzzle-3x3">–ò–≥—Ä–∞—Ç—å</button>
            </div>

            <div class="level-card">
                <div class="level-title">üß© –¶–µ—Ö —Å–±–æ—Ä–∫–∏ –ª–æ–≥–æ—Ç–∏–ø–∞ 4√ó4 (16 –∫–ª–µ—Ç–æ–∫)</div>
                <div class="level-stats">–õ—É—á—à–µ–µ –≤—Ä–µ–º—è: <span id="stat-puzzle-4x4">‚Äî</span></div>
                <button class="btn" data-level="puzzle-4x4">–ò–≥—Ä–∞—Ç—å</button>
            </div>

            <div class="level-card">
                <div class="level-title">üèÉ –¶–µ—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≤–∫–æ—Å—Ç–∏</div>
                <div class="level-stats">–õ—É—á—à–∏–π —Å—á–µ—Ç: <span id="stat-jumper">‚Äî</span></div>
                <button class="btn" data-level="jumper">–ò–≥—Ä–∞—Ç—å</button>
            </div>

            <div class="level-card">
                <div class="level-title">üè≠ –¶–µ—Ö —Å–±–æ—Ä–∫–∏ –¥–µ—Ç–∞–ª–µ–π (2048)</div>
                <div class="level-stats">–õ—É—á—à–∏–π —Å—á–µ—Ç: <span id="stat-2048">‚Äî</span></div>
                <button class="btn" data-level="factory-2048">–ò–≥—Ä–∞—Ç—å</button>
            </div>

            <div class="level-card">
                <div class="level-title">üß† –¶–µ—Ö —É–º–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π</div>
                <div class="level-stats">–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="stat-quiz">‚Äî</span></div>
                <button class="btn" data-level="quiz">–ò–≥—Ä–∞—Ç—å</button>
            </div>
        </div>

        <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:12px;">
            <button class="btn btn-secondary" data-action="reset-stats">–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
            <button class="btn" data-action="save-stats">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
        </div>
    </div>


    <!-- –≠–∫—Ä–∞–Ω 2: –ü–∞–∑–ª (–£—Ä–æ–≤–µ–Ω—å 1) -->
    <div id="screen-level1" class="screen">
        <h2>üß© –¶–µ—Ö —Å–±–æ—Ä–∫–∏ –ª–æ–≥–æ—Ç–∏–ø–∞</h2>
        <p>–°–æ–±–µ—Ä–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É (–∫–ª–∏–∫–Ω–∏ –Ω–∞ –¥–≤–µ –∫–ª–µ—Ç–∫–∏, —á—Ç–æ–±—ã –ø–æ–º–µ–Ω—è—Ç—å –∏—Ö –º–µ—Å—Ç–∞–º–∏)</p>
        <div id="puzzle-board"></div>
        <p id="puzzle-status"></p>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 3: –î–∂–∞–º–ø–µ—Ä (–£—Ä–æ–≤–µ–Ω—å 2) -->
    <div id="screen-level2" class="screen">
            <!-- –í–Ω—É—Ç—Ä–∏ <div id="screen-level2" ...> -->

        <div id="doodle-ui">
            <!-- –¢–∞–π–º–µ—Ä —Å–ª–µ–≤–∞ -->
            <div id="doodle-timer">‚è± 00:00</div>
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ —Ü–µ–Ω—Ç—Ä—É (–º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç –Ω–∞ –º–µ–ª–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) -->
            <h2 style="font-size: 14px; margin: 0 10px;">–°–æ–±–µ—Ä–∏ –¥–µ—Ç–∞–ª–∏</h2>
            <!-- –°—á–µ—Ç —Å–ø—Ä–∞–≤–∞ -->
            <div><span id="doodle-score">0</span>/10</div>

    </div>

                <!-- –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ -->
        <div id="doodle-container">
            <canvas id="doodle-canvas"></canvas>

            <!-- –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤) -->
            <div id="doodle-controls" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ">
                <button id="doodle-btn-left" class="doodle-control" aria-label="–ü—Ä—ã–≥–∞—Ç—å –≤–ª–µ–≤–æ" type="button">
                    <span class="arrow">‚Üê</span>
                </button>
                <button id="doodle-btn-right" class="doodle-control" aria-label="–ü—Ä—ã–≥–∞—Ç—å –≤–ø—Ä–∞–≤–æ" type="button">
                    <span class="arrow">‚Üí</span>
                </button>
            </div>

            <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
            <div id="doodle-start-msg" data-action="start-doodle">
                <p>–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!</p>
                <div class="tap-icon">üëÜ</div>
                <p style="font-size: 14px; color: #7f8c8d; margin-top: 20px;">
                    –¢–∞–ø–∞–π –≤–ª–µ–≤–æ –∏–ª–∏ –≤–ø—Ä–∞–≤–æ
                </p>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –ü–û–†–ê–ñ–ï–ù–ò–Ø (—Å–∫—Ä—ã—Ç) -->
            <div id="game-over-overlay" class="game-overlay">
                <h3>–û–π, —É–ø–∞–ª! üò¢</h3>
                <button class="btn-restart" data-action="start-doodle">üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –ü–û–ë–ï–î–´ (—Å–∫—Ä—ã—Ç) -->
            <div id="victory-overlay" class="game-overlay">
                <h1>üèÜ –ü–û–ë–ï–î–ê!</h1>
            </div>
        </div>

        <div id="factory-gate-container">
            <h3>‚ú® –ó–ê–í–û–î –ó–ê–ü–£–©–ï–ù! ‚ú®</h3>
            <picture>
                <source srcset="assets/gate.webp" type="image/webp">
                <img id="factory-gate-img" src="assets/gate.webp" alt="–ü—Ä–æ—Ö–æ–¥–Ω–∞—è">
            </picture>
            </div>

        <!-- –ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è ‚Äî —Ç–æ–ª—å–∫–æ –≤–æ–∑–≤—Ä–∞—Ç –∫ —É—Ä–æ–≤–Ω—è–º (–∫–Ω–æ–ø–∫–∞ –≤–≤–µ—Ä—Ö—É + —ç—Ç–∞ —Å–Ω–∏–∑—É) -->
    </div>

    <!-- –≠–∫—Ä–∞–Ω 4: –ò–≥—Ä–∞ 2048 (–£—Ä–æ–≤–µ–Ω—å 3) -->
    <div id="screen-level3" class="screen">
        <h2>üè≠ –¶–µ—Ö —Å–±–æ—Ä–∫–∏ –¥–µ—Ç–∞–ª–µ–π</h2>
        <p>–°–æ–µ–¥–∏–Ω—è–π –¥–µ—Ç–∞–ª–∏, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å <b>–ü—Ä–∏–±–æ—Ä (256)</b>!</p>

        <div class="game-2048-header">
            <div class="score-box">–°—á–µ—Ç: <span id="score-2048">0</span></div>
            <button data-action="init-2048" style="font-size: 20px; background:none; border:none; cursor:pointer;">üîÑ</button>

    </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã (relative) -->
        <div style="position: relative; width: 300px; margin: 0 auto;">
            <div id="grid-container">
                <!-- –Ø—á–µ–π–∫–∏ —Å–µ—Ç–∫–∏ -->
            </div>

            <!-- –û–í–ï–†–õ–ï–ô –ü–û–†–ê–ñ–ï–ù–ò–Ø -->
            <div id="overlay-2048-gameover" class="game-overlay" style="border-radius: 10px;">
                <h3>–¶–µ—Ö –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω! üòî</h3>
                <p style="color: white; font-size: 14px;">–ú–µ—Å—Ç–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å.</p>
                <button class="btn-restart" data-action="init-2048">üîÑ –û—á–∏—Å—Ç–∏—Ç—å –ª–∏–Ω–∏—é</button>
            </div>

            <!-- –û–í–ï–†–õ–ï–ô –ü–û–ë–ï–î–´ -->
            <div id="overlay-2048-victory" class="game-overlay" style="border-radius: 10px;">
                <h1>üèÜ –ì–û–¢–û–í–û!</h1>
                <p style="color: #f1c40f;">–ü—Ä–∏–±–æ—Ä —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ!</p>
            </div>
        </div>

        <p class="instruction">–°–≤–∞–π–ø–∞–π (–ª–∏—Å—Ç–∞–π) –ø–∞–ª—å—Ü–µ–º,<br>—á—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å –¥–µ—Ç–∞–ª–∏</p>

        <!-- –ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è ‚Äî —Ç–æ–ª—å–∫–æ –≤–æ–∑–≤—Ä–∞—Ç –∫ —É—Ä–æ–≤–Ω—è–º (–∫–Ω–æ–ø–∫–∞ –≤–≤–µ—Ä—Ö—É) -->
    </div>

    <!-- –≠–∫—Ä–∞–Ω 5: –ö–≤–∏–∑ (–£—Ä–æ–≤–µ–Ω—å 4) -->
    <div id="screen-level4" class="screen">
        <h2>üß† –¶–µ—Ö —É–º–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π</h2>
        <div id="quiz-progress">–í–æ–ø—Ä–æ—Å 1</div>
        <div id="quiz-container">
            <div id="question-text">...</div>
            <div id="answers-block"></div>
        </div>
    </div>

<!-- –≠–∫—Ä–∞–Ω 5: –§–∏–Ω–∞–ª (–û–±—â–∏–π –∏—Ç–æ–≥) -->
    <div id="screen-final" class="screen">
        <h1>üéâ –§–ò–ù–ò–®!</h1>
        <p>–¢–≤–æ—è —Å–º–µ–Ω–∞ –Ω–∞ –∑–∞–≤–æ–¥–µ –æ–∫–æ–Ω—á–µ–Ω–∞.</p>

        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å—ã–≥—Ä–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ -->
        <div class="final-score-box">
            <div id="final-stats-list"></div>
            <hr>
            <div class="score-row total">
                <span>–ò–¢–û–ì–û (–æ—á–∫–∏):</span> <span id="final-score-val">0</span>
            </div>
        </div>

        <div id="final-actions" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:12px;">
            <button class="btn btn-secondary" data-action="show-levels">‚Üê –ö —É—Ä–æ–≤–Ω—è–º</button>
            <button class="btn" data-action="final-send-stats">–ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ</button>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>

